<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.motreen.ml').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="aria2 RPC 自带许多事件Hook机制，其中就有下载完成的事件 hook。  aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: --on-bt-download-complete, --on-">
<meta property="og:type" content="article">
<meta property="og:title" content="macOS下 给aria2 RPC添加一个下载通知">
<meta property="og:url" content="https://blog.motreen.ml/posts/49311/index.html">
<meta property="og:site_name" content="春">
<meta property="og:description" content="aria2 RPC 自带许多事件Hook机制，其中就有下载完成的事件 hook。  aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: --on-bt-download-complete, --on-">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png">
<meta property="article:published_time" content="2020-02-14T11:07:36.000Z">
<meta property="article:modified_time" content="2021-03-02T00:57:33.977Z">
<meta property="article:author" content="沙漠之子">
<meta property="article:tag" content="aria2">
<meta property="article:tag" content="macOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png">

<link rel="canonical" href="https://blog.motreen.ml/posts/49311/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>macOS下 给aria2 RPC添加一个下载通知 | 春</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="春" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">春</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.motreen.ml/posts/49311/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沙漠之子">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="春">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          macOS下 给aria2 RPC添加一个下载通知
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-14 19:07:36" itemprop="dateCreated datePublished" datetime="2020-02-14T19:07:36+08:00">2020-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-02 08:57:33" itemprop="dateModified" datetime="2021-03-02T08:57:33+08:00">2021-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>aria2 RPC 自带许多事件<a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">Hook</a>机制，其中就有下载完成的事件 hook。</p>
<blockquote>
<p>aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: <code>--on-bt-download-complete</code>, <code>--on-download-pause</code>, <code>--on-download-complete</code>. <code>--on-download-start</code>, <code>--on-download-error</code>, <code>--on-download-stop</code>.</p>
</blockquote>
<h2 id="创建-hook-脚本"><a class="markdownIt-Anchor" href="#创建-hook-脚本"></a> 创建 hook 脚本</h2>
<blockquote>
<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">aria2 event-hook</a></li>
<li><a target="_blank" rel="noopener" href="https://code-maven.com/display-notification-from-the-mac-command-line">Display notification from the Mac command line</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zixi.org/archives/notification_on_macos.html">在mac命令行执行显示通知</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/17243326/7488424">Pass in variable from shell script to applescript</a></li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.aria2/</span><br><span class="line">touch download-complete-hook.sh</span><br><span class="line">chmod +x download-complete-hook.sh</span><br></pre></td></tr></table></figure>
<p>脚本内容添加如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">fname=`basename <span class="variable">$3</span>`</span><br><span class="line">osascript &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">display notification &quot;$fname 已经下载完成！&quot; with title &quot;【下载完成】&quot;</span></span><br><span class="line"><span class="string">say &quot;有个文件下载完成，请查收！&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>最终效果：当下载完成会在屏幕右上角弹出一个提示框显示具体下载完成的文件名，同时中文语音播报：“有个文件下载完成，请查收！”</p>
<p><img src="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png" alt="macOS 下aria2 提示框实例" /></p>
<ul>
<li>具体提示框设置可参考上面的教程。不支持设置自定义图标</li>
<li>关于<code>$3</code>参数<a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">详见</a></li>
</ul>
<blockquote>
<p>aria2 passes 3 arguments to specified command when it is executed. These arguments are: GID, the number of files and file path. For HTTP, FTP, and SFTP downloads, usually the number of files is 1. BitTorrent download can contain multiple files. If number of files is more than one, file path is first one. In other words, this is the value of path key of first struct whose selected key is true in the response of aria2.getFiles() RPC method. If you want to get all file paths, consider to use JSON-RPC/XML-RPC. Please note that file path may change during download in HTTP because of redirection or Content-Disposition header.</p>
</blockquote>
<h2 id="添加-hook-设置"><a class="markdownIt-Anchor" href="#添加-hook-设置"></a> 添加 Hook 设置</h2>
<p>在 aria2 设置文件<code>.aria2.conf</code>加入如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BT下载完成(如有做种将包含做种，如需调用请务必确定设定完成做种条件)</span></span><br><span class="line">on-bt-download-complete=<span class="variable">$&#123;HOME&#125;</span>/.aria2/download-complete-hook.sh</span><br><span class="line"><span class="comment"># 下载完成</span></span><br><span class="line">on-download-complete=<span class="variable">$&#123;HOME&#125;</span>/.aria2/download-complete-hook.sh</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/aria2/" rel="tag"># aria2</a>
              <a href="/tags/macOS/" rel="tag"># macOS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/49934/" rel="prev" title="使用aria2下载视频文件">
      <i class="fa fa-chevron-left"></i> 使用aria2下载视频文件
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/25284/" rel="next" title="使用 `BCFG` 命令管理 UEFI 启动菜单">
      使用 `BCFG` 命令管理 UEFI 启动菜单 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="maboloshi/Blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-hook-%E8%84%9A%E6%9C%AC"><span class="nav-number">1.</span> <span class="nav-text"> 创建 hook 脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-hook-%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text"> 添加 Hook 设置</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">沙漠之子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/maboloshi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;maboloshi" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沙漠之子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.4.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0
  </div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
















  

  

  

</body>
</html>

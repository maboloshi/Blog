<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/Blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/Blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/Blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/Blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/Blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/orange/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"maboloshi.github.io","root":"/Blog/","images":"/Blog/images","scheme":"Pisces","darkmode":true,"version":"8.17.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/Blog/js/config.js"></script>

    <meta name="description" content="aria2 RPC 自带许多事件Hook机制，其中就有下载完成的事件 hook。  aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: --on-bt-download-complete, --on-">
<meta property="og:type" content="article">
<meta property="og:title" content="macOS下 给aria2 RPC添加一个下载通知">
<meta property="og:url" content="https://maboloshi.github.io/Blog/posts/49311/index.html">
<meta property="og:site_name" content="春">
<meta property="og:description" content="aria2 RPC 自带许多事件Hook机制，其中就有下载完成的事件 hook。  aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: --on-bt-download-complete, --on-">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png">
<meta property="article:published_time" content="2020-02-14T11:07:36.000Z">
<meta property="article:modified_time" content="2023-07-15T01:45:09.012Z">
<meta property="article:author" content="沙漠之子">
<meta property="article:tag" content="aria2">
<meta property="article:tag" content="macOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png">


<link rel="canonical" href="https://maboloshi.github.io/Blog/posts/49311/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://maboloshi.github.io/Blog/posts/49311/","path":"posts/49311/","title":"macOS下 给aria2 RPC添加一个下载通知"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>macOS下 给aria2 RPC添加一个下载通知 | 春</title>
  








  <noscript>
    <link rel="stylesheet" href="/Blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/Blog/atom.xml" title="春" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/Blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">春</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/Blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/Blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/Blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/Blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-hook-%E8%84%9A%E6%9C%AC"><span class="nav-number">1.</span> <span class="nav-text"> 创建 hook 脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-hook-%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text"> 添加 Hook 设置</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">沙漠之子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/Blog/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/Blog/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/maboloshi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;maboloshi" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://maboloshi.github.io/Blog/posts/49311/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/Blog/images/avatar.gif">
      <meta itemprop="name" content="沙漠之子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="春">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="macOS下 给aria2 RPC添加一个下载通知 | 春">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          macOS下 给aria2 RPC添加一个下载通知
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-14 19:07:36" itemprop="dateCreated datePublished" datetime="2020-02-14T19:07:36+08:00">2020-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-15 09:45:09" itemprop="dateModified" datetime="2023-07-15T09:45:09+08:00">2023-07-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>aria2 RPC 自带许多事件<a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">Hook</a>机制，其中就有下载完成的事件 hook。</p>
<blockquote>
<p>aria2 provides options to specify arbitrary command after specific event occurred. Currently following options are available: <code>--on-bt-download-complete</code>, <code>--on-download-pause</code>, <code>--on-download-complete</code>. <code>--on-download-start</code>, <code>--on-download-error</code>, <code>--on-download-stop</code>.</p>
</blockquote>
<h2 id="创建-hook-脚本"><a class="markdownIt-Anchor" href="#创建-hook-脚本"></a> 创建 hook 脚本</h2>
<blockquote>
<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">aria2 event-hook</a></li>
<li><a target="_blank" rel="noopener" href="https://code-maven.com/display-notification-from-the-mac-command-line">Display notification from the Mac command line</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zixi.org/archives/notification_on_macos.html">在mac命令行执行显示通知</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/17243326/7488424">Pass in variable from shell script to applescript</a></li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.aria2/</span><br><span class="line"><span class="built_in">touch</span> download-complete-hook.sh</span><br><span class="line"><span class="built_in">chmod</span> +x download-complete-hook.sh</span><br></pre></td></tr></table></figure>
<p>脚本内容添加如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">fname=`<span class="built_in">basename</span> <span class="variable">$3</span>`</span><br><span class="line">osascript &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">display notification &quot;$fname 已经下载完成！&quot; with title &quot;【下载完成】&quot;</span></span><br><span class="line"><span class="string">say &quot;有个文件下载完成，请查收！&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>最终效果：当下载完成会在屏幕右上角弹出一个提示框显示具体下载完成的文件名，同时中文语音播报：“有个文件下载完成，请查收！”</p>
<p><img src="https://user-images.githubusercontent.com/7850715/74525348-cc159f80-4f18-11ea-84bd-56be79bf3b0a.png" alt="macOS 下aria2 提示框实例" /></p>
<ul>
<li>具体提示框设置可参考上面的教程。不支持设置自定义图标</li>
<li>关于<code>$3</code>参数<a target="_blank" rel="noopener" href="https://aria2.github.io/manual/en/html/aria2c.html#event-hook">详见</a></li>
</ul>
<blockquote>
<p>aria2 passes 3 arguments to specified command when it is executed. These arguments are: GID, the number of files and file path. For HTTP, FTP, and SFTP downloads, usually the number of files is 1. BitTorrent download can contain multiple files. If number of files is more than one, file path is first one. In other words, this is the value of path key of first struct whose selected key is true in the response of aria2.getFiles() RPC method. If you want to get all file paths, consider to use JSON-RPC/XML-RPC. Please note that file path may change during download in HTTP because of redirection or Content-Disposition header.</p>
</blockquote>
<h2 id="添加-hook-设置"><a class="markdownIt-Anchor" href="#添加-hook-设置"></a> 添加 Hook 设置</h2>
<p>在 aria2 设置文件<code>.aria2.conf</code>加入如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BT下载完成(如有做种将包含做种，如需调用请务必确定设定完成做种条件)</span></span><br><span class="line">on-bt-download-complete=<span class="variable">$&#123;HOME&#125;</span>/.aria2/download-complete-hook.sh</span><br><span class="line"><span class="comment"># 下载完成</span></span><br><span class="line">on-download-complete=<span class="variable">$&#123;HOME&#125;</span>/.aria2/download-complete-hook.sh</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/Blog/tags/aria2/" rel="tag"># aria2</a>
              <a href="/Blog/tags/macOS/" rel="tag"># macOS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Blog/posts/49934/" rel="prev" title="使用aria2下载视频文件">
                  <i class="fa fa-chevron-left"></i> 使用aria2下载视频文件
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Blog/posts/25284/" rel="next" title="使用 `BCFG` 命令管理 UEFI 启动菜单">
                  使用 `BCFG` 命令管理 UEFI 启动菜单 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">沙漠之子</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/Blog/js/comments.js"></script><script src="/Blog/js/utils.js"></script><script src="/Blog/js/motion.js"></script><script src="/Blog/js/next-boot.js"></script><script src="/Blog/js/pjax.js"></script>

  




  <script src="/Blog/js/third-party/pace.js"></script>


  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"maboloshi/Blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/Blog/js/third-party/comments/utterances.js"></script>

</body>
</html>
